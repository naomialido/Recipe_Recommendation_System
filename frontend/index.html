<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Recommendation App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        //Icons as SVG components
        const SearchIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const ChefHatIcon = () => (
            <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
            </svg>
        );

        const ClockIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const UtensilsIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
        );

        const XIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const StarIcon = ({ filled }) => (
            <svg className="w-4 h-4" fill={filled ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
            </svg>
        );

        function RecipeApp() {
            const [ingredients, setIngredients] = useState([]);
            const [currentInput, setCurrentInput] = useState('');
            const [recommendations, setRecommendations] = useState([]);
            const [loading, setLoading] = useState(false);
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [backendStatus, setBackendStatus] = useState('checking');
            const [useAI, setUseAI] = useState(false);
            const [aiAnalysis, setAiAnalysis] = useState('');

            const AWS_IP = 'http://18.221.70.66';
            const API_URL = `${AWS_IP}:5000/api`;

            useEffect(() => {
                checkBackendHealth();
            }, []);

            const checkBackendHealth = async () => {
                try {
                    const response = await fetch(`${API_URL}/health`);
                    const data = await response.json();
                    setBackendStatus('connected');
                } catch (error) {
                    setBackendStatus('disconnected');
                    console.error('Backend connection failed:', error);
                }
            };

            const addIngredient = () => {
                const trimmed = currentInput.trim().toLowerCase();
                if (trimmed && !ingredients.includes(trimmed)) {
                    setIngredients([...ingredients, trimmed]);
                    setCurrentInput('');
                }
            };

            const removeIngredient = (ing) => {
                setIngredients(ingredients.filter(i => i !== ing));
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    addIngredient();
                }
            };

            const getRecommendations = async () => {
                if (ingredients.length === 0) {
                    alert('Please add at least one ingredient');
                    return;
                }

                if (backendStatus !== 'connected') {
                    alert('Backend server is not connected. Please start the Flask server.');
                    return;
                }

                setLoading(true);
                setRecommendations([]);
                setAiAnalysis('');

                try {
                    const endpoint = useAI ? `${API_URL}/recommend-ai` : `${API_URL}/recommend`;

                    // NEW: send prompt when useAI is true
                    const body = useAI
                        ? { prompt: `Suggest recipes using: ${ingredients.join(", ")}` }
                        : { ingredients };

                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(body)
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        alert('Error: ' + data.error);
                        return;
                    }

                    setRecommendations(data.recommendations || []);
                    if (data.aiAnalysis) {
                        setAiAnalysis(data.aiAnalysis);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to get recommendations. Make sure the backend server is running.');
                } finally {
                    setLoading(false);
                }
            };

            const renderStars = (rating) => {
                const stars = [];
                const numRating = parseFloat(rating) || 0;
                for (let i = 1; i <= 5; i++) {
                    stars.push(<StarIcon key={i} filled={i <= numRating} />);
                }
                return stars;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-50 via-white to-amber-50">
                    <div className="max-w-6xl mx-auto p-6">
                        {/* Header */}
                        {/* Input Section */}
                        {/* Ingredients Tags */}
                        {/* AI Toggle */}
                        {/* Search Button */}
                        {/* AI Analysis */}
                        {/* Results */}
                        {/* Placeholder for image upload */}
                        {/* Recipe Detail Modal */}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<RecipeApp />, document.getElementById('root'));
    </script>
</body>
</html>