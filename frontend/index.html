<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Recommendation App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        //Icons as SVG components
        const SearchIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const ChefHatIcon = () => (
            <svg
                className="w-12 h-12"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                {/*base of chef hat */}
                <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M4 9c0-3 2.5-5.5 6-5.5h4c3.5 0 6 2.5 6 5.5
                    0 1.5-.5 2.5-1.2 3.5H5.2C4.5 11.5 4 10.5 4 9z"
                />
                {/*angular folds of chef hat*/}
                <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M8 4v5m4-5v5m4-5v5"
                />
                {/*tall thin band*/}
                <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M8 13h8v7a2 2 0 01-2 2h-4a2 2 0 01-2-2v-7z"
                />
            </svg>
            );






        const ClockIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const UtensilsIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
        );

        const XIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const StarIcon = ({ filled }) => (
            <svg className="w-4 h-4" fill={filled ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
            </svg>
        );

        function RecipeApp() {
            const [ingredients, setIngredients] = useState([]);
            const [currentInput, setCurrentInput] = useState('');
            const [recommendations, setRecommendations] = useState([]);
            const [loading, setLoading] = useState(false);
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [backendStatus, setBackendStatus] = useState('checking');
            const [useAI, setUseAI] = useState(false);
            const [aiAnalysis, setAiAnalysis] = useState('');


           const API_URL = ["localhost", "127.0.0.1"].includes(window.location.hostname)? "http://127.0.0.1:5000/api": "http://18.221.70.66:5000/api";


            useEffect(() => {
                checkBackendHealth();
            }, []);

            const checkBackendHealth = async () => {
                try {
                    const response = await fetch(`${API_URL}/health`);
                    const data = await response.json();
                    setBackendStatus('connected');
                } catch (error) {
                    setBackendStatus('disconnected');
                    console.error('Backend connection failed:', error);
                }
            };

            const addIngredient = () => {
                const trimmed = currentInput.trim().toLowerCase();
                if (trimmed && !ingredients.includes(trimmed)) {
                    setIngredients([...ingredients, trimmed]);
                    setCurrentInput('');
                }
            };

            const removeIngredient = (ing) => {
                setIngredients(ingredients.filter(i => i !== ing));
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    addIngredient();
                }
            };

            const getRecommendations = async () => {
                if (ingredients.length === 0) {
                    alert('Please add at least one ingredient');
                    return;
                }

                if (backendStatus !== 'connected') {
                    alert('Backend server is not connected. Please start the Flask server.');
                    return;
                }

                setLoading(true);
                setRecommendations([]);
                setAiAnalysis('');

                try {
                    const endpoint = useAI ? `${API_URL}/recommend-ai` : `${API_URL}/recommend`;
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ ingredients })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        alert('Error: ' + data.error);
                        return;
                    }

                    setRecommendations(data.recommendations || []);
                    if (data.aiAnalysis) {
                        setAiAnalysis(data.aiAnalysis);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to get recommendations. Make sure the backend server is running.');
                } finally {
                    setLoading(false);
                }
            };

            const renderStars = (rating) => {
                const stars = [];
                const numRating = parseFloat(rating) || 0;
                for (let i = 1; i <= 5; i++) {
                    stars.push(<StarIcon key={i} filled={i <= numRating} />);
                }
                return stars;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-50 via-white to-amber-50">
                    <div className="max-w-6xl mx-auto p-6">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center gap-3 mb-3">
                                <ChefHatIcon />
                                <h1 className="text-4xl font-bold text-gray-800">Recipe Finder</h1>
                            </div>
                            <p className="text-gray-600">Enter your ingredients and discover delicious recipes from our database</p>
                            
                            {/* Backend Status */}
                            <div className="mt-4 flex items-center justify-center gap-2">
                                <div className={`w-3 h-3 rounded-full ${backendStatus === 'connected' ? 'bg-green-500' : backendStatus === 'disconnected' ? 'bg-red-500' : 'bg-yellow-500'}`}></div>
                                <span className="text-sm text-gray-600">
                                    Backend: {backendStatus === 'connected' ? 'Connected' : backendStatus === 'disconnected' ? 'Disconnected' : 'Checking...'}
                                </span>
                            </div>
                        </div>

                        {/* Main Card */}
                        <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                            {/* Input Section */}
                            <div className="mb-6">
                                <label className="block text-sm font-semibold text-gray-700 mb-3">
                                    What ingredients do you have?
                                </label>
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={currentInput}
                                        onChange={(e) => setCurrentInput(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        placeholder="e.g., chicken, tomatoes, garlic..."
                                        className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-orange-400 focus:outline-none transition-colors"
                                    />
                                    <button
                                        onClick={addIngredient}
                                        className="px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-medium"
                                    >
                                        Add
                                    </button>
                                </div>
                            </div>

                            {/* Ingredients Tags */}
                            {ingredients.length > 0 && (
                                <div className="mb-6">
                                    <div className="flex flex-wrap gap-2">
                                        {ingredients.map((ing, idx) => (
                                            <span
                                                key={idx}
                                                className="inline-flex items-center gap-2 px-4 py-2 bg-orange-100 text-orange-700 rounded-full font-medium"
                                            >
                                                {ing}
                                                <button
                                                    onClick={() => removeIngredient(ing)}
                                                    className="hover:bg-orange-200 rounded-full p-1 transition-colors"
                                                >
                                                    <XIcon />
                                                </button>
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* AI Toggle */}
                            <div className="mb-6">
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        checked={useAI}
                                        onChange={(e) => setUseAI(e.target.checked)}
                                        className="w-4 h-4 text-orange-500 rounded focus:ring-orange-400"
                                    />
                                    <span className="text-sm text-gray-700">
                                        Use AI-enhanced recommendations (includes analysis)
                                    </span>
                                </label>
                            </div>

                            {/* Search Button */}
                            <button
                                onClick={getRecommendations}
                                disabled={loading || ingredients.length === 0}
                                className="w-full py-4 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg font-semibold text-lg hover:from-orange-600 hover:to-amber-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            >
                                {loading ? (
                                    <>
                                        <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                        Finding Recipes...
                                    </>
                                ) : (
                                    <>
                                        <SearchIcon />
                                        Find Recipes
                                    </>
                                )}
                            </button>
                        </div>

                        {/* AI Analysis */}
                        {aiAnalysis && (
                            <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-6">
                                <h3 className="text-lg font-bold text-blue-900 mb-3">ðŸ¤– AI Analysis</h3>
                                <p className="text-gray-700 whitespace-pre-wrap">{aiAnalysis}</p>
                            </div>
                        )}

                        {/* Results */}
                        {recommendations.length > 0 && (
                            <div className="grid md:grid-cols-2 gap-4">
                                {recommendations.map((recipe, idx) => (
                                    <div
                                        key={idx}
                                        className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer"
                                        onClick={() => setSelectedRecipe(recipe)}
                                    >
                                        <div className="flex justify-between items-start mb-2">
                                            <h3 className="text-xl font-bold text-gray-800 flex-1">{recipe.name}</h3>
                                            {recipe.rating && recipe.rating !== 'N/A' && (
                                                <div className="flex items-center gap-1 text-yellow-500">
                                                    {renderStars(recipe.rating)}
                                                    <span className="text-sm text-gray-600 ml-1">{recipe.rating}</span>
                                                </div>
                                            )}
                                        </div>
                                        
                                        <p className="text-sm text-orange-600 font-medium mb-1">{recipe.cuisine}</p>
                                        <p className="text-sm text-gray-500 mb-3">{recipe.category}</p>
                                        
                                        <div className="mb-4">
                                            <p className="text-sm font-semibold text-gray-700 mb-2">Matched Ingredients:</p>
                                            <div className="flex flex-wrap gap-1">
                                                {recipe.matchedIngredients?.map((ing, i) => (
                                                    <span key={i} className="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full">
                                                        {ing}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="flex gap-4 text-sm text-gray-500">
                                            <div className="flex items-center gap-1">
                                                <ClockIcon />
                                                <span>Prep: {recipe.prepTime}</span>
                                            </div>
                                            <div className="flex items-center gap-1">
                                                <UtensilsIcon />
                                                <span>Cook: {recipe.cookTime}</span>
                                            </div>
                                        </div>

                                        {recipe.matchScore && (
                                            <div className="mt-3">
                                                <div className="flex justify-between text-xs text-gray-500 mb-1">
                                                    <span>Match Score</span>
                                                    <span>{(recipe.matchScore * 100).toFixed(1)}%</span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                    <div 
                                                        className="bg-orange-500 h-2 rounded-full transition-all"
                                                        style={{width: `${recipe.matchScore * 100}%`}}
                                                    ></div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Placeholder for image upload */}
                        <div className="mt-8 bg-gray-100 rounded-2xl p-8 text-center border-2 border-dashed border-gray-300">
                            <ChefHatIcon />
                            <h3 className="text-xl font-semibold text-gray-600 mb-2 mt-4">Image Recognition</h3>
                            <p className="text-gray-500">NOT YET AVAILABLE</p>
                            <p className="text-sm text-gray-400 mt-2">Upload or capture food images to detect ingredients</p>
                        </div>
                    </div>

                    {/* Recipe Detail Modal */}
                    {selectedRecipe && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
                            onClick={() => setSelectedRecipe(null)}
                        >
                            <div 
                                className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-8"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h2 className="text-3xl font-bold text-gray-800">{selectedRecipe.name}</h2>
                                        {selectedRecipe.rating && selectedRecipe.rating !== 'N/A' && (
                                            <div className="flex items-center gap-1 text-yellow-500 mt-2">
                                                {renderStars(selectedRecipe.rating)}
                                                <span className="text-sm text-gray-600 ml-1">
                                                    {selectedRecipe.rating} rating
                                                </span>
                                            </div>
                                        )}
                                    </div>
                                    <button
                                        onClick={() => setSelectedRecipe(null)}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div className="flex gap-4 mb-4">
                                    <span className="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm font-medium">
                                        {selectedRecipe.cuisine}
                                    </span>
                                    <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                                        {selectedRecipe.category}
                                    </span>
                                </div>
                                
                                <div className="grid md:grid-cols-3 gap-4 mb-6">
                                    <div className="flex items-center gap-2">
                                        <ClockIcon />
                                        <div>
                                            <p className="font-semibold text-gray-700 text-sm">Prep Time</p>
                                            <p className="text-gray-600">{selectedRecipe.prepTime}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <UtensilsIcon />
                                        <div>
                                            <p className="font-semibold text-gray-700 text-sm">Cook Time</p>
                                            <p className="text-gray-600">{selectedRecipe.cookTime}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                        <div>
                                            <p className="font-semibold text-gray-700 text-sm">Servings</p>
                                            <p className="text-gray-600">{selectedRecipe.servings}</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="mb-6">
                                    <h4 className="font-bold text-gray-800 mb-3 text-lg">Matched Ingredients</h4>
                                    <div className="flex flex-wrap gap-2">
                                        {selectedRecipe.matchedIngredients?.map((ing, i) => (
                                            <span key={i} className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                                                âœ“ {ing}
                                            </span>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-6">
                                    <h4 className="font-bold text-gray-800 mb-3 text-lg">All Ingredients</h4>
                                    <p className="text-gray-700 whitespace-pre-wrap">{selectedRecipe.ingredients}</p>
                                </div>

                                <div className="mb-6">
                                    <h4 className="font-bold text-gray-800 mb-3 text-lg">Instructions</h4>
                                    <p className="text-gray-700 whitespace-pre-wrap">{selectedRecipe.instructions}</p>
                                </div>

                                {selectedRecipe.url && selectedRecipe.url !== 'N/A' && (
                                    <a 
                                        href={selectedRecipe.url}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="inline-block px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-medium"
                                    >
                                        View Original Recipe â†’
                                    </a>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<RecipeApp />, document.getElementById('root'));
    </script>
</body>
</html>